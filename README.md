# Postfix language compiler

Компилятор для стекового языка с [постфиксным синтаксисом](https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D1%80%D0%B0%D1%82%D0%BD%D0%B0%D1%8F_%D0%BF%D0%BE%D0%BB%D1%8C%D1%81%D0%BA%D0%B0%D1%8F_%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D1%8C).

Целевая платформа: linux-x86_64

Тьюринг-полнота:

- [X] арифметические операции
- [X] dup, drop, take
- [X] списки команд
- [X] ветвление
- [X] биндинги

Прикольчики:

- [x] e2e-тесты
- [ ] написанная документация mdbook
- [ ] понятные ошибки, предупреждения, сообщения
- [ ] debug-проверки и debug-info
- [ ] рефакторинг взаимодействия с `nasm`, `ld`
- [ ] мидварь для compile-time проверок и оптимизаций
- [ ] макросы на кодген
- [ ] информация о типах
- [ ] стек в динамической памяти
- [ ] гипотеза: аннотации для безопасной работы со стеком

## Поддерживаемый синтаксис

- 32-битные числа со знаком;
- Арифметические операторы `+`, `-`, `*`, `/`;
- Логические операторы `not`, `and`, `or`, `==`, `!=`, `>`, `>=`, `<=`, `<` (правда == `1`, ложь == `0`);
- Побитовые операторы `not`, `and`, `or`;
- Оператор вывода в stdout `.`;
- Комментарии, начинающиеся с `#` до конца строки;
- Операторы `dup` (дублировать элемент на вершине стека), `drop` (сбросить элемент на вершину стека), `take` (положить N элемент на вершину стека, где N -- значение элемента на вершине до операции);
- Списки команд, заключенные в `[` и `]`;
- Оператор применения списка команд `!`;
- Оператор `b` преобразования числа `X` по правилу:

```
X == 0 => X = 0 
X != 0 => X = 1
```

- Оператор ветвления `?` (в зависимости от значения вершины стека оставляет после себя первое или второе значение на стеке);
- Оператор `:{name}` для привязывания имени к элементу с вершины стека. Оператор привязки возможно указать только 1 раз для одного имени (временная дырка до ввода мидлвари); 
- Оператор `{name}`, кладущий на стек элемент, привязанный к имени `name`.

## Как получить

Для установки необходимо выполнить:

```bash
curl -sSfL https://raw.githubusercontent.com/vzalygin/plc/refs/heads/master/install.sh | sh
```

## Как собрать

В системе должны быть установлены `cargo`, `nasm`.

Скомпилировать компилятор:

```bash
git clone https://github.com/vzalygin/plc
cd plc
cargo build
```

## Примеры

Доступны в папке [examples](./examples). Также в папке [e2e](https://github.com/vzalygin/plc/blob/master/e2e/src/lib.rs) можно посмотреть сквозные тесты, описывающие поведение компилятора.
